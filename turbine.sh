#!/bin/bash
#github-action genshdoc
#
# @file ArchTitus
# @brief Entrance script that launches children scripts for each phase of installation.

# Find the name of the folder the scripts are in
set -a
SCRIPT_DIR="$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"
SCRIPTS_DIR="$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"/scripts
CONFIGS_DIR="$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"/configs
set +a
echo -ne "
-------------------------------------------------------------------------
                                                                                
                            .:^7J5PGGBBBBBBGP5Y?!^:.                            
                       .~JPB####BGG55YYYJYY5PGB#####B5?^.                       
                   .~YB###G5?~:.                .:~?5B###GJ^.                   
                .!P###P?^.          .:^~!7777!^:.     .~YB###5~                 
              :Y###P!.          ^75B#############G7.      :7G###J:              
            ~P##B?.          .JB###################5         :J###5:            
          ^P##G~    .::     7####################G7.           .?B##5.          
        .Y##B!   .JG###G   .B#################P7:    :~!~^.      .?###7         
       ^B##Y.  .Y#######~   5##############P~.     7G######GJ~     :G##P.       
      !###~   :B########7   .B###########G^      7B###########B?.    J##B:      
     7##B^   ^##########?    :B##########!     .P################J.   !###^     
    !##B:   .G##########5     .5#########!    .G##################B~   !###:    
   :B##!    ?############:      !B#######G.   G#####################?   ?##G    
   5##Y    .G############B7.     .5#######G?~J#######################~  .G##?   
  ^B#B:    .################G5J77P##GY?!7?PB##########G5YPG##########B   !##G.  
  ?##P     .G#####################Y.  ...   :P#####P~.     .^?PB#####B   .B##~  
  5##?      ^####################^  7G###BP~  7###~             :7YP5:    P##?  
 .P##!       .?PB###########B###?  5########!  5##. .::^^~^^:.            ?##Y  
 .P##!           .:^~~!~^^:. ~##?  P########!  Y###B###########B5!        ?##Y  
  5##7    ~YY?~.             7##B^  ?B####G!  7###################G.      P##J  
  ?##P   .######BY!.      .~G#####?.  ....  :5#####################J      B##~  
  ^##B:  .##########BPY?YG##########GJ7~!7YG##5?JYPB###############5     !##G.  
   P##Y   Y#######################?!5########?      ^5#############Y     G##J   
   :B##~   5#####################J   ^B#######G^      7############!    7##B.   
    !##B:   ?###################P     J#########J      ###########P    !###:    
     ?##B:   :5################Y      J##########P     B#########G.   ~###^     
      7###~    ^5############B~      ~B###########P    P########P.   ?##B^      
       ^B##J     .75B######G!     .!P##############7   Y#######?   .P##G.       
        .5##B~       :~!!~:    :7P#################P   :####G?.   7###?         
          ^G##P^            .7G###################B~    .^^.    7B##P:          
            ~G##G7.        .G###################B?.          :?B##P^            
              ^5###5~.      :YB#############B57:          .!P###Y:              
                .7G###P?:.     .^!7???7!~^:.          .^JG###5!.                
                   .!5####GY7^.                 .:~75G###BY~.                   
                       :!YG#####BGP5YYJ??JYY5PGB####BPJ~.                       
                            .:~?Y5GBBBBBBBBBGP5J7~:.                            
                                                                                
-------------------------------------------------------------------------
                    Automated TurbineOS Installer
-------------------------------------------------------------------------
                Scripts are in directory named ArchTitus
"
    ( bash $SCRIPT_DIR/scripts/startup.sh )|& tee startup.log
      source $CONFIGS_DIR/setup.conf
    ( bash $SCRIPT_DIR/scripts/0-preinstall.sh )|& tee 0-preinstall.log
    ( arch-chroot /mnt $HOME/ArchTitus/scripts/1-setup.sh )|& tee 1-setup.log
    if [[ ! $DESKTOP_ENV == server ]]; then
      ( arch-chroot /mnt /usr/bin/runuser -u $USERNAME -- /home/$USERNAME/ArchTitus/scripts/2-user.sh )|& tee 2-user.log
    fi
    ( arch-chroot /mnt $HOME/ArchTitus/scripts/3-post-setup.sh )|& tee 3-post-setup.log
    cp -v *.log /mnt/home/$USERNAME

echo -ne "
-------------------------------------------------------------------------
                                                                                
                            .:^7J5PGGBBBBBBGP5Y?!^:.                            
                       .~JPB####BGG55YYYJYY5PGB#####B5?^.                       
                   .~YB###G5?~:.                .:~?5B###GJ^.                   
                .!P###P?^.          .:^~!7777!^:.     .~YB###5~                 
              :Y###P!.          ^75B#############G7.      :7G###J:              
            ~P##B?.          .JB###################5         :J###5:            
          ^P##G~    .::     7####################G7.           .?B##5.          
        .Y##B!   .JG###G   .B#################P7:    :~!~^.      .?###7         
       ^B##Y.  .Y#######~   5##############P~.     7G######GJ~     :G##P.       
      !###~   :B########7   .B###########G^      7B###########B?.    J##B:      
     7##B^   ^##########?    :B##########!     .P################J.   !###^     
    !##B:   .G##########5     .5#########!    .G##################B~   !###:    
   :B##!    ?############:      !B#######G.   G#####################?   ?##G    
   5##Y    .G############B7.     .5#######G?~J#######################~  .G##?   
  ^B#B:    .################G5J77P##GY?!7?PB##########G5YPG##########B   !##G.  
  ?##P     .G#####################Y.  ...   :P#####P~.     .^?PB#####B   .B##~  
  5##?      ^####################^  7G###BP~  7###~             :7YP5:    P##?  
 .P##!       .?PB###########B###?  5########!  5##. .::^^~^^:.            ?##Y  
 .P##!           .:^~~!~^^:. ~##?  P########!  Y###B###########B5!        ?##Y  
  5##7    ~YY?~.             7##B^  ?B####G!  7###################G.      P##J  
  ?##P   .######BY!.      .~G#####?.  ....  :5#####################J      B##~  
  ^##B:  .##########BPY?YG##########GJ7~!7YG##5?JYPB###############5     !##G.  
   P##Y   Y#######################?!5########?      ^5#############Y     G##J   
   :B##~   5#####################J   ^B#######G^      7############!    7##B.   
    !##B:   ?###################P     J#########J      ###########P    !###:    
     ?##B:   :5################Y      J##########P     B#########G.   ~###^     
      7###~    ^5############B~      ~B###########P    P########P.   ?##B^      
       ^B##J     .75B######G!     .!P##############7   Y#######?   .P##G.       
        .5##B~       :~!!~:    :7P#################P   :####G?.   7###?         
          ^G##P^            .7G###################B~    .^^.    7B##P:          
            ~G##G7.        .G###################B?.          :?B##P^            
              ^5###5~.      :YB#############B57:          .!P###Y:              
                .7G###P?:.     .^!7???7!~^:.          .^JG###5!.                
                   .!5####GY7^.                 .:~75G###BY~.                   
                       :!YG#####BGP5YYJ??JYY5PGB####BPJ~.                       
                            .:~?Y5GBBBBBBBBBGP5J7~:.                            
                                                                                
-------------------------------------------------------------------------
                    Automated TurbineOS Installer
-------------------------------------------------------------------------
                Done - Please Eject Install Media and Reboot
"
